Hereâ€™s your full text converted into English, with structure and code blocks preserved and small typos fixed (e.g., closing backticks):

---

# Optimal Trajectory Generator â€” Waypoint Generation

This tutorial explains how to use the **(Optimal) Trajectory Generator** to generate an optimal racing line on a track.

---

## 1. Recommended Environment

We recommend using a Python **3.8** virtual environment.
Choose one of the following two methods.

### (1) Using Anaconda

```bash
# Install Anaconda
bash ~/Downloads/Anaconda3-{version}-Linux-x86_64.sh
echo "export PATH=~/anaconda3/bin:~/anaconda3/condabin:$PATH" >> ~/.bashrc
source ~/.bashrc
conda config --set auto_activate_base False

# Create and activate a virtual environment
conda create -n traj_generator python=3.8
conda activate traj_generator
```

### (2) Using venv

```bash
python3 -m venv ./traj_generator
source ./traj_generator/bin/activate  # Activate virtual environment
```

---

## 2. Installation

```bash
# Initialize a new Git repository
git init

# Enable sparse checkout
git config core.sparseCheckout true

# Add remote repository (zzjun725 repo)
git remote add -f origin https://github.com/zzjun725/f1tenth-racing-stack-ICRA22.git

# Specify only the required directory
echo trajectory_generator/* > .git/info/sparse-checkout

# Fetch from the main branch
git pull origin main

# (Optional) Remove unnecessary Git metadata
rm -rf .git

# Install dependencies
cd trajectory_generator
pip install -r requirements.txt
 
# Create config directory and download params.yaml
mkdir config && cd config
curl -L -O https://raw.githubusercontent.com/jinkimh/f1tenth-racing-stack-ICRA22/main/config/params.yaml

# Download `maps` directory
cd ../  # move out of config folder
curl -L -o maps.zip https://github.com/jinkimh/f1tenth-racing-stack-ICRA22/archive/refs/heads/main.zip
unzip maps.zip 'f1tenth-racing-stack-ICRA22-main/maps/*'
mv f1tenth-racing-stack-ICRA22-main/maps ./maps
rm -rf f1tenth-racing-stack-ICRA22-main maps.zip
```

---

## 3. Configuration

### (1) Adding Map Data

Create the `trajectory_generator/maps` directory and place your **map image file** (`.png`, `.jpg`) and corresponding **map metadata file** (`.yaml`) inside.

```plaintext
trajectory_generator/
 â”œâ”€â”€ config/
 â”‚    â””â”€â”€ params.yaml
 â”œâ”€â”€ maps/
 â”‚    â”œâ”€â”€ mytrack.png
 â”‚    â””â”€â”€ mytrack.yaml
```

Example `mytrack.yaml`:

```yaml
image: mytrack.png
resolution: 0.05
origin: [0.0, 0.0, 0.0]
negate: 0
occupied_thresh: 0.65
free_thresh: 0.196
```

---

### (2) Editing params.yaml

In `trajectory_generator/config/params.yaml`, update the **map name** and **file extension**:

```yaml
# Example params.yaml
map_name: mytrack
map_img_ext: .png

# Path generation parameters (tune as needed)
track_width: 0.8
vehicle_width: 0.3
smoothing_weight: 0.5
```

---

## 4. Execute

### (1) Generate Centerline

```bash
python3 ~/trajectory_generator/lane_generator.py
```

### (2) Generate Optimal Trajectory

```bash
python3 ~/trajectory_generator/main_globaltraj.py
```

---

## 5. Troubleshooting

### (1) quadprog-related Error

```text
ImportError: /home/mina/anaconda3/envs/traj_generator/lib/python3.8/site-packages/quadprog.cpython-38-x86_64-linux-gnu.so: undefined symbol: _Z7qpgen2_PdS_PiS0_S_S_S_S_S_S0_S0_S0_S0_S0_S0_S_S0_
```

âž¡ Solution:

```bash
conda install -c conda-forge quadprog=0.1.7
```

---

## 6. Parameter Tuning

* If the GUI crashes or you see error messages in the terminal,
  try modifying the parameters in the `params/racecar.ini` file.

---

## 7. Example Directory Structure

```plaintext
trajectory_generator/
 â”œâ”€â”€ config/
 â”‚    â””â”€â”€ params.yaml
 â”œâ”€â”€ maps/
 â”‚    â”œâ”€â”€ mytrack.png
 â”‚    â””â”€â”€ mytrack.yaml
 â”œâ”€â”€ requirements.txt
 â”œâ”€â”€ lane_generator.py
 â”œâ”€â”€ main_globaltraj.py
```

---

## ðŸ“Œ Notes

* This tutorial is intended for use in the **F1Tenth Bootcamp** experiment environment.
* It has been tested with Python 3.8.
* You can use map images generated by OpenCV or by the ROS `map_server`.

---

# Optimal Trajectory Generator â€” Parameter Manual

This document explains the main parameters and options that can be configured when running `main_globaltraj.py`.

```text
1. Input path and vehicle parameter settings (file_paths, veh_params_file)
2. Debug and plotting options (debug, plot_opts)
3. Track import and transformation options (imp_opts)
4. Optimization algorithm selection and detailed options (opt_type, mintime_opts)
5. Lap time calculation and result saving options (lap_time_mat_opts)
```

---

## 1. Vehicle Parameter File

```python
file_paths = {"veh_params_file": "racecar.ini"}
```

* Path to the `.ini` file containing vehicle physical parameters
* Specify a file inside the `params/` folder
* Examples: `racecar.ini`, `f1tenth.ini`, etc.

---

## 2. Debug & Plot Options

```python
debug = True
plot_opts = {
    "mincurv_curv_lin": False,  # Plot linearization results for minimum curvature
    "raceline": True,           # Show optimized racing line
    "imported_bounds": False,   # Show imported track boundaries
    "raceline_curv": True,      # Show curvature profile of racing line
    "racetraj_vel": True,       # Show velocity profile
    "racetraj_vel_3d": False,   # Show 3D velocity profile
    "racetraj_vel_3d_stepsize": 1.0,
    "spline_normals": False,    # Show spline normal vectors
    "mintime_plots": False      # Internal plots for minimum-time optimization
}
```

* **`debug`**: When `True`, prints detailed logs.
* **`plot_opts`**: Select which plots and visualizations to display after execution.

---

## 3. Track Import Options (`imp_opts`)

```python
imp_opts = {
    "flip_imp_track": False,               # Reverse track direction
    "set_new_start": False,                # Use a new start position
    "new_start": np.array([0.0, -47.0]),   # Start position (x, y)
    "min_track_width": None,               # Enforce minimum track width (m)
    "num_laps": 1                          # Number of laps
}
```

* **`flip_imp_track`**: Flip the track driving direction.
* **`set_new_start` + `new_start`**: Set a desired starting location.
* **`min_track_width`**: Force narrow sections to have at least this width.
* **`num_laps`**: Number of laps (be careful when there are power/thermal limits).

---

## 4. Optimization Type (`opt_type`)

```python
# Available modes
opt_type = 'mincurv_iqp'
```

* `'shortest_path'` : Compute shortest path by distance.
* `'mincurv'` : Single-run minimum curvature path.
* `'mincurv_iqp'` : Iterative quadratic programming for minimum curvature.
* `'mintime'` : Minimum-time trajectory (includes velocity optimization).

---

## 5. Minimum-Time Options (`mintime_opts`)

```python
mintime_opts = {
    "tpadata": None,                    # Friction map data file
    "warm_start": False,                # Warm start IPOPT with previous solution
    "var_friction": None,               # None / "linear" / "gauss"
    "reopt_mintime_solution": False,    # Re-optimize mintime result with mincurv
    "recalc_vel_profile_by_tph": False  # Recalculate velocity profile using ggv
}
```

* **`tpadata`**: Path to a JSON file for friction map data.
* **`warm_start`**: Use the previous solution as an initial guess.
* **`var_friction`**: Apply spatially varying friction coefficients.
* **`reopt_mintime_solution`**: Refine the minimum-time solution with curvature optimization.
* **`recalc_vel_profile_by_tph`**: Recompute the velocity profile based on the ggv diagram.

---

## 6. Lap Time Matrix Options (`lap_time_mat_opts`)

```python
lap_time_mat_opts = {
    "use_lap_time_mat": False,        # Enable lap-time matrix computation
    "gg_scale_range": [0.3, 1.0],     # Range of ggv scaling factors
    "gg_scale_stepsize": 0.05,        # Step size for ggv scaling
    "top_speed_range": [100.0, 150.0],# Top speed range [km/h]
    "top_speed_stepsize": 5.0,        # Step size for top speed
    "file": "lap_time_matrix.csv"     # Output filename
}
```

* Computes expected lap times for various combinations of ggv scaling and top speeds.
* Set `use_lap_time_mat=True` to enable this feature.

---

## 7. Vehicle Dynamics Parameters

Values loaded from the `.ini` file include:

* **`veh_params`**: Vehicle width, length, mass, maximum speed, etc.
* **`ggv_file`**: Path to the ggv diagram data file.
* **`stepsize_opts`**: Sampling step sizes.
* **`reg_smooth_opts`**: Spline regularization and smoothing parameters.
* **`optim_opts`**: Internal optimization parameters for each mode.

---

## 8. Parameter Tuning Tips

* **Vehicle leaves the track in tight corners** â†’ Decrease `veh_params["curvlim"]`.
* **Racing line is too centralized** â†’ Adjust `optim_opts["width_opt"]`.
* **Velocity profile is unrealistically high** â†’ Lower `v_max` or increase `dragcoeff`.
* **Lap time computation is too slow** â†’ Increase step sizes in `stepsize_opts`.

---

## ðŸ“Œ Notes

* After changing parameters, deleting the `outputs/` directory and re-running will recompute everything from scratch.
* The `'mintime'` mode can be computationally expensive depending on CPU performance and IPOPT settings.

---

## ðŸ“„ Copyright

```text
Â© 2025 Jin Kim, Gyeongsang National University

This document was created for experimental and educational use with the F1Tenth autonomous driving platform.
Unauthorized reproduction and commercial use are prohibited.
```

---
